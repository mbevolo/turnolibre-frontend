<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel del Club</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fullcalendar/bootstrap5@6.1.8/main.min.css" rel="stylesheet">
    <link href="https://unpkg.com/leaflet/dist/leaflet.css" rel="stylesheet">

    <style>
      /* Contenedor de agendas */
      #agendas-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
        gap: 24px;
        width: 100% !important;
        max-width: 100% !important;
      }

      /* Calendarios individuales */
      [id^="calendar-"] {
        min-height: 500px !important;
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 2px 8px #0001;
        padding: 6px;
        margin-bottom: 10px;
      }

      /* Mejoras de eventos */
      .fc-event-title,
      .fc-event-time,
      .fc-event-main {
        white-space: pre-line !important;
        overflow-wrap: break-word !important;
        font-size: 1em;
        line-height: 1.3;
        padding: 0 2px;
      }

      .fc-event {
        min-height: 42px;
        max-height: none;
        height: auto !important;
      }
    </style>
  </head>

  <body class="bg-light">

<div class="container-fluid my-4">

  <div id="bloque-destacar-club"></div>

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1>Panel del Club</h1>

    <div>
      <button id="btn-mis-datos" class="btn btn-outline-primary btn-sm me-2">Mis Datos</button>
      <button id="cerrar-sesion" class="btn btn-danger btn-sm">Cerrar sesión</button>
    </div>
  </div>

  <!-- NAV TABS -->
  <ul class="nav nav-tabs" id="clubTabs" role="tablist">

    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="info-tab" data-bs-toggle="tab" data-bs-target="#infoTab" type="button" role="tab">Información del Club</button>
    </li>

    <li class="nav-item" role="presentation">
      <button class="nav-link" id="canchas-tab" data-bs-toggle="tab" data-bs-target="#canchasTab" type="button" role="tab">Canchas</button>
    </li>

    <li class="nav-item" role="presentation">
      <button class="nav-link" id="agenda-tab" data-bs-toggle="tab" data-bs-target="#agendaTab" type="button" role="tab">Agenda</button>
    </li>

    <li class="nav-item" role="presentation">
      <button class="nav-link" id="reservas-tab" data-bs-toggle="tab" data-bs-target="#reservasTab" type="button" role="tab">Reservas</button>
    </li>

    <!-- Estadísticas -->
    <li class="nav-item ms-auto" role="presentation">
      <a class="nav-link text-primary fw-bold" href="estadisticas.html">Estadísticas</a>
    </li>

  </ul>

  <!-- TAB CONTENT -->
  <div class="tab-content mt-3" id="clubTabsContent">

    <!-- INFO -->
    <div class="tab-pane fade show active" id="infoTab" role="tabpanel" aria-labelledby="info-tab">
      <div id="info-bienvenida" class="mb-3"></div>
      <h5>Reservas para hoy</h5>
      <div id="lista-reservas-hoy" class="mt-3"></div>
    </div>

    <!-- CANCHAS -->
    <div class="tab-pane fade" id="canchasTab" role="tabpanel" aria-labelledby="canchas-tab">
      <div id="canchas-list" class="row g-3 mb-3"></div>
      <button id="agregar-cancha" class="btn btn-success">Agregar cancha</button>
    </div>

    <!-- AGENDA (CORREGIDA) -->
    <div class="tab-pane fade" id="agendaTab" role="tabpanel" aria-labelledby="agenda-tab">

      <!-- Selector de cancha (solo una vez) -->
      <div class="mb-3" style="max-width: 400px;">
        <div id="selector-cancha"></div>
      </div>

      <!-- Calendarios -->
      <div class="w-100">
        <div id="agendas-container"></div>
      </div>

    </div>

    <!-- RESERVAS -->
    <div class="tab-pane fade" id="reservasTab" role="tabpanel" aria-labelledby="reservas-tab">
      <ul class="nav nav-tabs mb-2" id="subTabsReservas" role="tablist">
        <li class="nav-item"><button class="nav-link active" id="sub-reservas-tab" data-bs-toggle="tab" data-bs-target="#subReservas" type="button">Reservas</button></li>
        <li class="nav-item"><button class="nav-link" id="sub-historial-tab" data-bs-toggle="tab" data-bs-target="#subHistorial" type="button">Historial</button></li>
      </ul>

      <div class="tab-content">
        <div class="tab-pane fade show active" id="subReservas">
          <table class="table">
            <thead><tr><th>Cancha</th><th>Fecha</th><th>Hora</th><th>Usuario</th><th>Estado</th><th>Acción</th></tr></thead>
            <tbody id="reservas-list"></tbody>
          </table>
        </div>

        <div class="tab-pane fade" id="subHistorial">
          <table class="table">
            <thead><tr><th>Cancha</th><th>Fecha</th><th>Hora</th><th>Usuario</th><th>Estado</th></tr></thead>
            <tbody id="historial-list"></tbody>
          </table>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- Scripts -->
<script src="js/club-advanced.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<script>
  document.getElementById('btn-mis-datos').addEventListener('click', () => {
    window.location.href = 'mis-datos.html';
  });

  document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('button[data-bs-toggle="tab"]');

    tabs.forEach(tab => {
      tab.addEventListener('shown.bs.tab', async event => {
        const id = event.target.id;

        if (id === 'agenda-tab' && typeof cargarAgendas === 'function') await cargarAgendas();
        if (id === 'reservas-tab' && typeof cargarReservas === 'function') await cargarReservas();
        if (id === 'canchas-tab' && typeof cargarCanchas === 'function') await cargarCanchas();
      });
    });
  });
</script>

<script src="js/footer.js"></script>

  </body>
</html>
